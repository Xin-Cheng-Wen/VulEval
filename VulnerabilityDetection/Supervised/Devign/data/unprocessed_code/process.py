import json, os
from tqdm import tqdm

files = ['train_cdata.jsonl', 'valid_cdata.jsonl', 'test_cdata.jsonl']
names = ['train', 'valid', 'test']
DIR = '../raw_code'
dic = []

os.makedirs(DIR, exist_ok=True)
for label, (file, name) in enumerate(zip(files, names)):
    with open(file) as f:
        for num, line in enumerate(f):
            js = json.loads(line)
            target, func = js['label'], js['code']
            # target, _, func = line.split('<CODESPLIT>')

            file_name = f'{name}{num}_{target}.c'
            dic.append({'file_name': file_name})
            with open(f'{DIR}/{file_name}', 'w') as g:
                print(func, file=g)

with open('../cfg.json', 'w') as f:
    print(json.dumps(dic), file=f)
