import json
from sklearn.metrics import accuracy_score, recall_score, precision_score, f1_score, matthews_corrcoef

filename = '/data/xcwen/ReposVulBench/llama/dataset/all/time/test_c_cpp_answer_llama_13b.jsonl'
targets = []
preds = []
cnt = 0
with open(filename) as f:
    for line in f:
        obj = json.loads(line)
        targets.append(obj['target'])
        answer = obj['answer']
        if 'not vulnerable' not in answer.lower() and 'vulnerable' in answer.lower():
            preds.append(1)
        else:
            preds.append(0)

acc = accuracy_score(targets, preds)
recall = recall_score(targets, preds)
precision = precision_score(targets, preds)   
f1 = f1_score(targets, preds)       
mcc = matthews_corrcoef(targets, preds)      
result = {
    "eval_accuracy": float(acc),
    "eval_precision": float(precision),
    "eval_recall": float(recall),
    "eval_f1": float(f1),
    "eval_mcc": float(mcc),
}

print(result)


